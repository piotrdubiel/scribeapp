apply plugin: 'android-library'

repositories {
    mavenCentral()
}

dependencies {
    def nativeLibs = new File("$buildDir/native-libs")
    if (!nativeLibs.exists()) {
        nativeLibs.mkdirs()
    }
    new File("$nativeLibs/native-libs.jar").createNewFile()
    
    compile files('libs/native-libs.jar')
}

android {
    compileSdkVersion 19
    buildToolsVersion "19.0.0"

    defaultConfig {
        minSdkVersion 7
        targetSdkVersion 19
    }
}

task copyNative(type: Jar, dependsOn: 'buildNative') {
    from("${project.projectDir}/libs/") {
        include("**/*.so")
    }
    into("lib/")
    destinationDir(new File("${project.projectDir}/libs/"))
    archiveName("native-libs.jar")

}

task buildNative(type: Exec) {
    description "Builds NDK with BLAS included"
    workingDir "${project.projectDir}/jni/"

    if (System.env.NDK_ROOT != null) {
	    def ndkBuild = new File(System.env.NDK_ROOT, 'ndk-build')
		executable ndkBuild
    }
}

tasks.withType(JavaCompile) { compileTask -> compileTask.dependsOn copyNative }

clean.dependsOn 'cleanPackageNative'

tasks.withType(com.android.build.gradle.tasks.PackageApplication) { pkgTask ->
    pkgTask.jniDir new File(buildDir, 'native-libs')
}
